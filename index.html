<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EchoStream</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --bg:#ffffff;
  --text:#000000;
  --card:#f3f3f3;
  --accent:#1da1f2;
  --border:#dddddd;
}
body.dark{
  --bg:#000000;
  --text:#ffffff;
  --card:#1c1c1c;
  --border:#333333;
}
body{
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  color:var(--text);
}
header{
  position:fixed;
  top:0;
  width:100%;
  padding:14px;
  font-weight:700;
  background:var(--bg);
  border-bottom:1px solid var(--border);
  z-index:10;
}
nav{
  position:fixed;
  bottom:0;
  width:100%;
  display:flex;
  justify-content:space-around;
  padding:12px 0;
  background:var(--bg);
  border-top:1px solid var(--border);
}
nav i{
  font-size:20px;
  cursor:pointer;
}
main{
  padding:80px 16px 90px;
  max-width:600px;
  margin:auto;
}
.card{
  background:var(--card);
  padding:16px;
  border-radius:16px;
  margin-bottom:12px;
}
textarea,input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--bg);
  color:var(--text);
}
button{
  background:var(--accent);
  color:white;
  border:none;
  padding:10px 18px;
  border-radius:999px;
  font-weight:600;
  margin-top:8px;
  cursor:pointer;
}
.hidden{display:none}
.avatar{
  width:60px;
  height:60px;
  border-radius:50%;
  background:#666;
  color:white;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  font-weight:700;
}
.verified{
  color:#1da1f2;
  margin-left:6px;
}
</style>
</head>

<body>

<header>EchoStream</header>

<main>

<!-- LOGIN -->
<div id="login">
  <h2>Welcome to EchoStream</h2>
  <button onclick="login()">Sign in with Google</button>
</div>

<!-- FEED -->
<div id="feed" class="hidden">
  <div class="card">
    <textarea id="postText" placeholder="Whatâ€™s happening?"></textarea>
    <button onclick="createPost()">Post</button>
  </div>
  <div id="posts"></div>
</div>

<!-- PROFILE -->
<div id="profile" class="hidden"></div>

<!-- SETTINGS -->
<div id="settings" class="hidden">
  <div class="card">
    <h3>Settings</h3>
    <label>
      <input type="checkbox" onchange="togglePrivate(this.checked)">
      Private account
    </label><br><br>
    <label>
      <input type="checkbox" onchange="toggleDark()">
      Dark mode
    </label>
  </div>
</div>

<!-- ADMIN -->
<div id="admin" class="hidden">
  <div class="card">
    <h3>Admin Panel</h3>
    <input id="verifyUid" placeholder="User UID to verify">
    <button onclick="verifyUser()">Verify User</button>
  </div>
</div>

</main>

<nav>
  <i class="fa fa-house" onclick="route('feed')"></i>
  <i class="fa fa-user" onclick="route('profile')"></i>
  <i class="fa fa-gear" onclick="route('settings')"></i>
  <i class="fa fa-shield" onclick="route('admin')"></i>
</nav>

<script>
/* FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "AIzaSyCmY_zfNcH5XnEaQxlqaTW1D8EUR670-Zo",
  authDomain: "echostream-a102a.firebaseapp.com",
  projectId: "echostream-a102a"
});

const auth = firebase.auth();
const db = firebase.firestore();
let userData = null;

/* AUTH */
function login(){
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
}

auth.onAuthStateChanged(async user=>{
  if(!user) return;
  document.getElementById("login").style.display="none";
  route("feed");

  const ref = db.collection("users").doc(user.uid);
  const snap = await ref.get();

  if(!snap.exists){
    await ref.set({
      username: user.displayName.replace(/\s/g,"").toLowerCase(),
      verified: false,
      role: "owner",
      private: false
    });
  }

  userData = (await ref.get()).data();
  loadFeed();
});

/* ROUTER */
function route(page){
  ["feed","profile","settings","admin"].forEach(p=>{
    document.getElementById(p).classList.add("hidden");
  });
  document.getElementById(page).classList.remove("hidden");

  if(page==="profile") loadProfile();
  if(page==="admin" && userData.role!=="owner"){
    alert("Admins only");
    route("feed");
  }
}

/* POSTS */
async function createPost(){
  if(!postText.value.trim()) return;
  await db.collection("posts").add({
    uid: auth.currentUser.uid,
    username: userData.username,
    text: postText.value,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });
  postText.value="";
  loadFeed();
}

async function loadFeed(){
  posts.innerHTML="";
  const snap = await db.collection("posts").orderBy("createdAt","desc").get();
  snap.forEach(d=>{
    const p=d.data();
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`<b>${p.username}</b><p>${p.text}</p>`;
    posts.appendChild(div);
  });
}

/* PROFILE */
function loadProfile(){
  profile.innerHTML=`
    <div class="card">
      <div class="avatar">${userData.username[0].toUpperCase()}</div>
      <h3>${userData.username}
      ${userData.verified ? '<i class="fa fa-check-circle verified"></i>' : ''}
      </h3>
      <p>Role: ${userData.role}</p>
    </div>
  `;
}

/* SETTINGS */
async function togglePrivate(val){
  await db.collection("users").doc(auth.currentUser.uid).update({private:val});
}
function toggleDark(){
  document.body.classList.toggle("dark");
}

/* ADMIN */
async function verifyUser(){
  const uid=document.getElementById("verifyUid").value.trim();
  if(!uid) return;
  await db.collection("users").doc(uid).update({verified:true});
  alert("User verified");
}
</script>

</body>
</html>