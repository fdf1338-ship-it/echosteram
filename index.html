<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EchoStream</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --bg: #f8f8f8; --text: #000; --accent: #4285F4; }
        body.dark { --bg: #000; --text: #fff; --accent: #8ab4f8; }
        body { margin:0; font-family: system-ui, sans-serif; background:var(--bg); color:var(--text); min-height:100vh; transition:0.3s; }
        .container { max-width:600px; margin:0 auto; padding:20px; text-align:center; padding-top:100px; }
        h1 { font-size:48px; margin:0; }
        .tagline { color:#ff0000; font-size:16px; margin:10px 0 30px; font-weight:600; }
        button { padding:14px 32px; font-size:18px; background:var(--accent); color:white; border:none; border-radius:8px; cursor:pointer; }
        button:hover { opacity:0.9; }
        #app { display:none; }
        .header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; border-bottom:1px solid #ddd; position:fixed; top:0; left:0; right:0; background:var(--bg); z-index:10; }
        .logo { width:40px; }
        .menu { cursor:pointer; font-size:24px; }
        .post-box { margin:70px 20px 20px; }
        textarea { width:100%; padding:12px; border:1px solid #ccc; border-radius:8px; font-size:16px; background:var(--bg); color:var(--text); }
        .feed { max-width:600px; margin:0 auto; }
        .post { padding:15px; border-bottom:1px solid #eee; text-align:left; }
        .username { font-weight:bold; }
        .verified { color:#1da1f2; margin-left:4px; }
        #modal, #username-modal { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7); align-items:center; justify-content:center; }
        .modal-content { background:var(--bg); padding:30px; border-radius:12px; width:90%; max-width:400px; text-align:center; }
        .settings-item { padding:10px 0; display:flex; justify-content:space-between; align-items:center; }
    </style>
</head>
<body>
    <!-- Logo -->
    <svg class="logo" style="display:none;" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <circle cx="16" cy="16" r="14" fill="none" stroke="currentColor" stroke-width="2"/>
        <path d="M 16 8 Q 16 22 16 8" stroke="#ff0000" stroke-width="3" fill="none" stroke-linecap="round"/>
    </svg>

    <div id="login-screen" class="container">
        <h1>EchoStream</h1>
        <p class="tagline">The feed they don't want you seeing.</p>
        <button id="google-signin">Sign in with Google</button>
        <p style="margin-top:20px; color:#666;">New accounts are created automatically</p>
    </div>

    <div id="app">
        <div class="header">
            <svg class="logo" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                <circle cx="16" cy="16" r="14" fill="none" stroke="currentColor" stroke-width="2"/>
                <path d="M 16 8 Q 16 22 16 8" stroke="#ff0000" stroke-width="3" fill="none" stroke-linecap="round"/>
            </svg>
            <div class="menu" onclick="document.getElementById('settings-modal').style.display='flex'">☰</div>
        </div>

        <div class="post-box">
            <textarea id="post-text" placeholder="What's happening?"></textarea>
            <button style="margin-top:10px; width:100%;" onclick="post()">Post</button>
        </div>

        <div class="feed" id="feed"></div>
    </div>

    <!-- Username modal -->
    <div id="username-modal">
        <div class="modal-content">
            <h2>Choose your username</h2>
            <input id="username-input" placeholder="@username" maxlength="20"/>
            <button style="margin-top:20px;" onclick="saveUsername()">Save</button>
            <button style="margin-left:10px; background:#666;" onclick="skipUsername()">Skip for now</button>
        </div>
    </div>

    <!-- Settings modal -->
    <div id="settings-modal">
        <div class="modal-content">
            <h2>Settings</h2>
            <div class="settings-item">
                <span>Dark mode</span>
                <label><input type="checkbox" id="dark-toggle" onchange="toggleDark()"/></label>
            </div>
            <div class="settings-item">
                <span>Privacy</span>
                <span>Public</span>
            </div>
            <div class="settings-item">
                <span>About</span>
                <span>Built with hope and a laptop</span>
            </div>
            <button style="margin-top:30px; background:#d33;" onclick="logout()">Logout</button>
            <button style="margin-top:10px; background:#666;" onclick="closeModal('settings-modal')">Close</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCmY_zfNcH5XnEaQxlqaTW1D8EUR670-Zo",
            authDomain: "echostream-a102a.firebaseapp.com",
            projectId: "echostream-a102a",
            storageBucket: "echostream-a102a.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let username = null;

        document.getElementById('google-signin').addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider);
        });

        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                document.querySelector('.logo').style.display = 'block';
                checkUsername();
                loadPosts();
            }
        });

        async function checkUsername() {
            const doc = await db.collection('users').doc(currentUser.uid).get();
            if (doc.exists && doc.data().username) {
                username = doc.data().username;
            } else {
                document.getElementById('username-modal').style.display = 'flex';
            }
        }

        async function saveUsername() {
            const input = document.getElementById('username-input').value.trim();
            if (input) {
                await db.collection('users').doc(currentUser.uid).set({ username: input, verified: false }, { merge: true });
                username = input;
                closeModal('username-modal');
            }
        }

        function skipUsername() {
            closeModal('username-modal');
            username = 'Anonymous';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        function toggleDark() {
            document.body.classList.toggle('dark');
        }

        async function post() {
            const text = document.getElementById('post-text').value.trim();
            if (text && currentUser) {
                await db.collection('posts').add({
                    text: text,
                    uid: currentUser.uid,
                    username: username || currentUser.displayName,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                document.getElementById('post-text').value = '';
                loadPosts();
            }
        }

        async function loadPosts() {
            const snapshot = await db.collection('posts').orderBy('timestamp', 'desc').get();
            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            snapshot.forEach(doc => {
                const data = doc.data();
                const div = document.createElement('div');
                div.className = 'post';
                div.innerHTML = `
                    <div class="username">${data.username || 'Anonymous'}
                        ${data.verified ? '<span class="verified">✓</span>' : ''}
                    </div>
                    <div>${data.text}</div>
                `;
                feed.appendChild(div);
            });
        }

        function logout() {
            auth.signOut();
            location.reload();
        }
    </script>
</body>
</html>